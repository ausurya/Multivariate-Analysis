---
title: "Facebook Ad Camp Analysis"
author: "Surya Aenuganti Ushasri"
date: "February 8, 2019"
output:
  pdf_document: default
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Loading data
```{r}
library(tidyverse)
dat = read.csv("KAG_conversion_data.csv")
#View(dat)
glimpse(dat)
```

```{r}
unique(dat$age)
```
## Adding new columns

Click Rate(click_rate)
```{r}
#clicks per 10000 impressions
dat<- dat %>% 
  mutate(click_rate = as.factor(ifelse(dat$Impressions != 0 , round(dat$Clicks/dat$Impressions*10000) , 0)))
```

Conversion Rate(conv_rate)
```{r}
#Approved conversions as a percentage of totatl conversions
dat<- dat %>% 
  mutate(conv_rate = ifelse(dat$Total_Conversion != 0 , round(dat$Approved_Conversion/dat$Total_Conversion*100) , 0))
```

Conversion rate as factor
```{r}
dat$conv_rate <-cut(dat$conv_rate, seq(0,100,10), right=TRUE, labels=c("0-10%","10-20%","20-30%","30-40%","40-50%","50-60%","60-70%","70-80%","80-90%","90-100%"))
dat$conv_rate[is.na(dat$conv_rate)] <- "0-10%"
```

Loss amount
```{r}
dat<- dat %>% 
  mutate(loss_amount = ifelse(dat$Clicks !=0, dat$Spent*(1 - dat$Approved_Conversion / dat$Clicks),0)) 
```

Loss rate 
```{r}
dat<- dat %>% 
  mutate(loss_rate =  ifelse(dat$Spent>0, round(dat$loss_amount/dat$Spent)*100,0)) 
dat$loss_rate <-cut(dat$loss_rate, seq(0,100,10), right=TRUE, labels=c("0-10%","10-20%","20-30%","30-40%","40-50%","50-60%","60-70%","70-80%","80-90%","90-100%"))
dat$loss_rate[is.na(dat$loss_rate)] <- "0-10%"
```


##Data Analysis

```{r}
table(dat$xyz_campaign_id)
```

There are 3 companies and the analysis will be done seperately

```{r}
dat_916<-dat %>% filter(xyz_campaign_id %in% c("916"))
library(ggplot2)

ggplot(data = dat_916) +
  aes(x = age, y = click_rate, fill = age) +
  geom_tile() +
  theme_minimal() +
  facet_wrap(vars(gender))

```

Analysis:
For both gender groups Male and Female the age group 30-34 seems to respond with higher click rate ranging from 2 to 5

But we cannot say anything conclusive about other groups because we don't have sufficient data in these groups

Return on spent
```{r}
library(ggplot2)

ggplot(data = dat_916) +
  aes(x = age, y = loss_rate, fill = loss_rate) +
  geom_tile() +
  theme_minimal() +
  facet_wrap(vars(gender))

```

We cannot conclude anything from these plots because in all the age groups of both genders there is a 50% loss of 0-10

##Analysis on a specific ad campaign


```{r}
ggplot(dat, aes(as.factor(xyz_campaign_id), Spent)) + geom_boxplot() + labs(x = "Campaign", y = "Advertising Spend")

ggplot(dat, aes(as.factor(xyz_campaign_id), Total_Conversion)) + geom_boxplot() + labs(x = "Campaign", y = "Conversions")
```

From the above first box-plot we can see that company 1178 spends more on advertisements comparatively

And the second box plot shows there is a more total conversion rate for company 1178


```{r}
dat1178 <- dat %>%
  filter(xyz_campaign_id == 1178)
```



```{r}
library(DataExplorer)
#Checking the frequency data variable by variable
options(repr.plot.width=4, repr.plot.height=4)
plot_bar(dat1178)
options(repr.plot.width=8, repr.plot.height=4)
plot_histogram(dat1178[,-2]) #removing xyzcampaign id 
```



```{r}
#Preliminary analysis of campaign 1178
#Let's look at what happens to the number of conversions and the value of our conversions when we spend more money on our campaign.
options(repr.plot.width=6, repr.plot.height=3)
ggplot(dat1178, aes(Spent, Total_Conversion)) + geom_point() + geom_smooth(method = "lm") +
  labs(x = "Amount spent on campaign", y = "Total number of conersions")
ggplot(dat1178, aes(Spent, Total_Conversion)) + geom_point() + geom_smooth(method = "lm") +
  labs(x = "Amount spent on campaign", y = "Total value of conversions")
```
Analysis:Here, itlooks like the more we spend, the more we get back.
But the amount of data is quite sparse at the right-hand side so we cannot say that the statement is accurate without considering more analysis.


```{r}
library(caret)
ds_1178_predict<-dat1178 %>% select( age, gender,interest, Impressions,Clicks,Spent)
set.seed(1234)
ds_1178_predict_Dummy <- dummyVars("~.",data=ds_1178_predict, fullRank=T)
ds_1178_predict_final <- as.data.frame(predict(ds_1178_predict_Dummy,ds_1178_predict))
print(names(ds_1178_predict_final))
library(corrplot)
corMatMy <- cor(ds_1178_predict_final)
corrplot(corMatMy, order = "hclust")
```

From the correlation matrix we can see that it's pretty obvious that the clicks are strongly correlated to impressions and spent.

